(()=>{"use strict";function e(e,t){let l=0;return{length:e,hits:l,direction:t,typeOfShip:()=>5===e?"carrier":4===e?"battleship":3===e?"cruiser":3===e?"submarine":2===e?"patrol boat":void 0,getHits:()=>l,increaseHit:()=>{l++},isSunk:()=>l>=e}}function t(){let e=[],t=[],l=[],o=[];const r=()=>e,i=()=>l;return{placeShip:(l,o,r)=>!!((e,l,o)=>{let r=[],i=!1;for(let t=0;t<e.length;t++)"horizontal"===e.direction?r.push([l+t,o]):r.push([l,o+t]);return r.forEach((e=>{t.some(((t,l)=>t[0]===e[0]&&t[1]===e[1]))&&(i=!0)})),!1===i&&("horizontal"===e.direction?l+e.length-1<10:o+e.length-1<10)})(l,o,r)&&(((l,o,r)=>{if("horizontal"===l.direction)for(let i=0;i<l.length;i++)e.push([l,o+i,r]),t.push([o+i,r]);else for(let i=0;i<l.length;i++)e.push([l,o,r+i]),t.push([o,r+i])})(l,o,r),!0),receiveAttack:(e,n)=>{console.log("occupied are:"),console.log(i());let[...a]=r();return null!=a.find(((t,l)=>t[1]===e&&t[2]===n))?(void 0===o.find(((t,l)=>t[0]===e&&t[1]===n))&&o.push([e,n]),!0):i().find(((t,l)=>t[0]===e&&t[1]===n))?void 0:(l.push([e,n]),t.push([e,n]),!1)},areAllSunk:()=>e.length===o.length,getCells:()=>t,getOccupiedCells:r,getHit:()=>o,getMissed:i}}document.querySelector(".grids");const l=document.querySelector(".player-grid"),o=document.querySelector(".AI-grid");let r,i,n;function a(e){if(!d()){let t;if("player"===r.getTurn()){let l=e.id.split(",");if(t=r.playerTurn(n,Number(l[0]),Number(l[1])),"hit"===t){let[...t]=n.getHit();[...t].forEach((t=>{t[0]===Number(l[0])&&t[1]===Number(l[1])&&(e.classList.add("hitted-cell"),e.classList.add("disabled-cell"))}))}else e.classList.add("missed-cell"),e.classList.add("disabled-cell"),c()}}}function c(e){if(!d()){let t;if(console.log(`from AI it is ${d()}`),"AI"===r.getTurn())if(t=void 0===e?r.AITurn(i):r.AITurn(i,e[0],e[1]),"AlreadyPlayed"===t[1])c();else if("missed"===t[1])[...l.childNodes].forEach((e=>{let l=e.id.split(",");t[0][0]===Number(l[0])&&t[0][1]===Number(l[1])&&setTimeout((()=>{e.classList.add("missed-cell")}),1e3)}));else if("hit"===t[1]){let[e]=r.getRandomAdjacent(t[0][0],t[0][1],i);[...l.childNodes].forEach((e=>{let l=e.id.split(",");Number(l[0])===t[0][0]&&Number(l[1])===t[0][1]&&setTimeout((()=>{e.classList.add("hitted-cell")}),0)})),c(e)}}}!function(){for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let o=document.createElement("div");l.appendChild(o).className="player-grid-item",o.innerText=`${t},${e}`,o.id=`${t},${e}`}}for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let l=document.createElement("div");o.appendChild(l).className="AI-grid-item",l.innerText=`${t},${e}`,l.id=`${t},${e}`}}}(),h();const d=()=>{if(n.areAllSunk()||i.areAllSunk())return s(),document.querySelector(".restart").classList.add("visible"),!0};function s(){const e=document.querySelector(".winner");i.areAllSunk()?e.innerText="AI Won":e.innerText="You Won"}function h(){r=function(){let e="player";return{getTurn:()=>e,changeTurn:t=>{console.log(`from player ${e}`),e=t},playerTurn:(t,l,o)=>{let r=t.receiveAttack(l,o);return void 0===r?"AlreadyMissed":r?r?"hit":void 0:(e="AI","missed")},AITurn:(t,l,o)=>{let r,i;return void 0===l&&void 0===o?(i=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],r=t.receiveAttack(i[0],i[1])):(i=[l,o],r=t.receiveAttack(l,o)),void 0===r?[i,"AlreadyPlayed"]:void 0!==r&&!0!==r?(e="player",[i,"missed"]):[i,"hit"]},getRandomAdjacent:(e,t,l)=>{let o=[[e+1,t],[e-1,t],[e,t+1],[e,t-1]].filter((e=>e[0]>=0&&e[0]<=9&&e[1]>=0&&e[1]<=9)),r=l.getMissed(),i=l.getHit(),n=r.concat(i);var a;return[((a=o.filter((e=>function(e){let t=!0;for(let l=0;l<n.length;l++)n[l][0]===e[0]&&n[l][1]===e[1]&&(t=!1);return t}(e))))[Math.floor(Math.random()*a.length)],a[Math.floor(Math.random()*a.length)])]}}}(),i=t(),n=t(),function(){let t=e(4,"horizontal"),l=e(3,"vertical"),o=e(3,"horizontal"),r=e(2,"vertical");i.placeShip(t,1,0),i.placeShip(l,3,5),i.placeShip(o,4,8),i.placeShip(r,7,6)}(),function(){let t=["horizontal","vertical"],l=e(4,t[Math.floor(Math.random()*t.length)]),o=e(3,t[Math.floor(Math.random()*t.length)]),r=e(3,t[Math.floor(Math.random()*t.length)]),i=e(2,t[Math.floor(Math.random()*t.length)]);for(console.log(l),console.log(o),console.log(r),console.log(i);!n.placeShip(l,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(o,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(r,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(i,Math.floor(10*Math.random()),Math.floor(10*Math.random())););}(),function(){const e=window.document.querySelectorAll(".player-grid-item");let t=i.getCells();console.log("it is "+n.getOccupiedCells()),e.forEach(((e,l)=>{t.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}));const l=window.document.querySelectorAll(".AI-grid-item");let o=n.getCells();o.forEach((e=>{})),l.forEach(((e,t)=>{o.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}))}()}[...o.childNodes].forEach(((e,t)=>{e.addEventListener("click",(function(){a(e),d()&&s()}))})),document.querySelector(".restart").addEventListener("click",(function(){(()=>{const e=window.document.querySelectorAll(".player-grid-item"),t=window.document.querySelectorAll(".AI-grid-item");e.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell")})),t.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell")}))})(),(()=>{const e=document.querySelector(".winner");document.querySelector(".restart").classList.remove("visible"),e.innerText=""})(),h()}))})();