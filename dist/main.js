(()=>{"use strict";function e(e,t,l){let i=0;return{length:e,hits:i,direction:t,name:l,getHits:()=>i,increaseHit:()=>{i++},isSunk:()=>i>=e}}function t(){let e=[],t=[],l=[],i=[];const s=()=>e,r=()=>l;return{placeShip:(l,i,s)=>!!((e,l,i)=>{let s=[],r=!1;for(let t=0;t<e.length;t++)"horizontal"===e.direction?s.push([l+t,i]):s.push([l,i+t]);return s.forEach((e=>{t.some(((t,l)=>t[0]===e[0]&&t[1]===e[1]))&&(r=!0)})),!1===r&&("horizontal"===e.direction?l+e.length-1<10:i+e.length-1<10)})(l,i,s)&&(((l,i,s)=>{if("horizontal"===l.direction)for(let r=0;r<l.length;r++)e.push([l,i+r,s]),t.push([i+r,s]);else for(let r=0;r<l.length;r++)e.push([l,i,s+r]),t.push([i,s+r])})(l,i,s),!0),receiveAttack:(e,n)=>{let[...a]=s(),o=a.find(((t,l)=>t[1]===e&&t[2]===n));return null!=o?(void 0===i.find(((t,l)=>t[0]===e&&t[1]===n))&&(i.push([e,n]),o[0].increaseHit()),!0):r().find(((t,l)=>t[0]===e&&t[1]===n))?void 0:(l.push([e,n]),t.push([e,n]),!1)},areAllSunk:()=>e.length===i.length,getCells:()=>t,getOccupiedCells:s,getHit:()=>i,getMissed:r}}let l=new Audio("./hit.mp3"),i=new Audio("./sunk.mp3");const s=document.querySelector(".grids");s.style.display="none";const r=document.querySelector(".player-msg");r.innerText="Your Turn";let n="x",a=0;const o=()=>0===a?4:1===a||2===a?3:2,c=document.querySelector(".player-grid"),d=document.querySelector(".AI-grid");let u,h,p;function m(){u=function(){let e="player";return{getTurn:()=>e,changeTurn:t=>{e=t},playerTurn:(t,l,i)=>{let s=t.receiveAttack(l,i);return void 0===s?"AlreadyMissed":s?s?"hit":void 0:(e="ai","missed")},AITurn:(e,t,l)=>{let i,s;return void 0===t&&void 0===l?(s=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],i=e.receiveAttack(s[0],s[1])):(s=[t,l],i=e.receiveAttack(t,l)),void 0===i?[s,"AlreadyPlayed"]:void 0!==i&&!0!==i?[s,"missed"]:[s,"hit"]},getRandomAdjacent:(e,t,l)=>{let i=[[e+1,t],[e-1,t],[e,t+1],[e,t-1]].filter((e=>e[0]>=0&&e[0]<=9&&e[1]>=0&&e[1]<=9)),s=l.getMissed(),r=l.getHit(),n=s.concat(r);var a;return[((a=i.filter((e=>function(e){let t=!0;for(let l=0;l<n.length;l++)n[l][0]===e[0]&&n[l][1]===e[1]&&(t=!1);return t}(e))))[Math.floor(Math.random()*a.length)],a[Math.floor(Math.random()*a.length)])]}}}(),h=t(),p=t()}function f(e){if(!S()){let t;if("player"===u.getTurn()){let i=e.id.split(",");if(t=u.playerTurn(p,Number(i[0]),Number(i[1])),"hit"===t){let[...t]=p.getHit();[...t].forEach((t=>{if(t[0]===Number(i[0])&&t[1]===Number(i[1])){e.classList.add("hitted-cell"),e.classList.add("disabled-cell");try{l.play()}catch{console.log("ship sunked, hit sound Stopped")}}})),g("ai")}else e.classList.add("missed-cell"),e.classList.add("disabled-cell"),u.changeTurn("ai"),y(),r.innerText="Computer's turn"}}}function y(e){if(!S()){let t;if("ai"===u.getTurn())if(t=void 0===e?u.AITurn(h):u.AITurn(h,e[0],e[1]),"AlreadyPlayed"===t[1])y();else if("missed"===t[1])[...c.childNodes].forEach((e=>{let l=e.id.split(",");t[0][0]===Number(l[0])&&t[0][1]===Number(l[1])&&setTimeout((()=>{e.classList.add("missed-cell")}),1e3)}));else if("hit"===t[1]){let[e]=u.getRandomAdjacent(t[0][0],t[0][1],h);[...c.childNodes].forEach((e=>{let i=e.id.split(",");Number(i[0])===t[0][0]&&Number(i[1])===t[0][1]&&(e.classList.add("hitted-cell"),l.play())})),g("player"),y(e)}setTimeout((()=>{r.innerText="Your Turn",u.changeTurn("player")}),2e3)}}function g(e){"ai"===e?p.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(v(t,e),L(t,e))})):h.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(v(t,e),L(t,e))}))}!function(){const e=document.querySelector(".start-grid");for(let t=9;t>=0;t--)for(let l=0;l<10;l++){let i=document.createElement("div");e.appendChild(i).className="placing-cells-item",i.id=`${l},${t}`}}(),m(),function(){for(let e=9;e>=0;e--)for(let t=0;t<10;t++){let l=document.createElement("div");c.appendChild(l).className="player-grid-item",l.id=`${t},${e}`}for(let e=9;e>=0;e--)for(let t=0;t<10;t++){let l=document.createElement("div");d.appendChild(l).className="AI-grid-item",l.id=`${t},${e}`}}();const v=(e,t)=>{const s=window.document.querySelectorAll(".player-grid-item"),r=window.document.querySelectorAll(".AI-grid-item");"ai"===t?r.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("ai-has-ship")){let s=t.id.split(",");Number(s[0])===e[1]&&Number(s[1])===e[2]&&(t.classList.add("sunk"),l.pause(),i.play())}})):s.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("player-has-ship")){let s=t.id.split(",");Number(s[0])===e[1]&&Number(s[1])===e[2]&&(t.classList.add("sunk"),l.pause(),i.play())}}))},L=(e,t)=>{const l=document.querySelectorAll(".ai-ships"),i=document.querySelectorAll(".player-ships");"ai"===t?l.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")})):i.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")}))},S=()=>{if(p.areAllSunk()||h.areAllSunk())return b(),document.querySelector(".restart").classList.add("visible"),!0};function b(){const e=document.querySelector(".winner");h.areAllSunk()?e.innerText="AI Won":e.innerText="You Won"}const M=()=>{const e=window.document.querySelectorAll(".player-grid-item"),t=window.document.querySelectorAll(".AI-grid-item");e.forEach((e=>{e.classList.remove("player-has-ship","hitted-cell","missed-cell","disabled-cell","sunk")})),t.forEach((e=>{e.classList.remove("ai-has-ship","hitted-cell","missed-cell","disabled-cell","sunk")}));const l=document.querySelector(".ships").children;let i=l[0].children,s=l[2].children;[...i].forEach((e=>{e.classList.remove("lineOver")})),[...s].forEach((e=>{e.classList.remove("lineOver")}))},E=()=>{const e=document.querySelector(".winner");document.querySelector(".restart").classList.remove("visible"),e.innerText=""};[...d.childNodes].forEach((e=>{e.addEventListener("click",(function(){"player"!==u.getTurn()||e.classList.contains("disabled-cell")||f(e),S()&&b()}))}));const A=window.document.querySelector(".start-grid").childNodes;function k(){A.forEach((e=>{e.classList.contains("placed-ship")&&e.classList.remove("placed-ship"),e.classList.contains("place-ship-hover")&&e.classList.remove("place-ship-hover")}))}[...A].forEach(((t,l)=>{t.addEventListener("mouseenter",(function(){a<4&&function(e,t){let l=e.id.split(","),i=o(),s=!0;if("x"===n){for(let e=0;e<i;e++)if(A[t+e]&&A[t+e].classList.contains("placed-ship")){s=!1;break}if(s&&Number(l[0])+i-1<=9)for(let e=0;e<i;e++)A[t+e].classList.add("place-ship-hover")}else{for(let e=0;e<i;e++)if(A[t-10*e]&&A[t-10*e].classList.contains("placed-ship")){s=!1;break}if(s&&Number(l[1])+i-1<=9)for(let e=0;e<i;e++)A[t-10*e].classList.add("place-ship-hover")}}(t,l)})),t.addEventListener("mouseleave",(function(){a<4&&function(e,t){let l=e.id.split(","),i=o();if("x"===n){if(Number(l[0])+i-1<=9)for(let e=0;e<i;e++)A[t+e].classList.remove("place-ship-hover")}else if(Number(l[1])+i-1<=9)for(let e=0;e<i;e++)A[t-10*e].classList.remove("place-ship-hover")}(t,l)})),t.addEventListener("click",(function(){t.classList.contains("place-ship-hover")&&a<4&&!t.classList.contains("placed-ship")&&(a++,function(t){let l=t.id.split(","),i="x"===n?"horizontal":"vertical";switch(a){case 1:let t=e(4,i,"battleship");h.placeShip(t,Number(l[0]),Number(l[1]));break;case 2:let s=e(3,i,"cruiser");h.placeShip(s,Number(l[0]),Number(l[1]));break;case 3:let r=e(3,i,"submarine");h.placeShip(r,Number(l[0]),Number(l[1]));break;case 4:let n=e(2,i,"patrol");h.placeShip(n,Number(l[0]),Number(l[1]))}}(t),A.forEach((e=>{e.classList.contains("place-ship-hover")&&e.classList.add("placed-ship")})))}))})),document.querySelector(".restart").addEventListener("click",(function(){s.style.display="none",M(),E(),m(),a=0,k(),document.querySelector(".placing-grid-container").style.display="flex"}));const N=document.querySelector(".x"),q=document.querySelector(".y");N.addEventListener("click",(function(){n="x",N.classList.add("pressed-btn"),q.classList.remove("pressed-btn")})),q.addEventListener("click",(function(){n="y",q.classList.add("pressed-btn"),N.classList.remove("pressed-btn")}));const T=document.querySelector(".reset");document.querySelector(".place").addEventListener("click",(function(){a>=4&&(document.querySelector(".placing-grid-container").style.display="none",s.style.display="flex",function(){let t=["horizontal","vertical"],l=e(4,t[Math.floor(Math.random()*t.length)],"battleship"),i=e(3,t[Math.floor(Math.random()*t.length)],"cruiser"),s=e(3,t[Math.floor(Math.random()*t.length)],"submarine"),r=e(2,t[Math.floor(Math.random()*t.length)],"patrol");for(;!p.placeShip(l,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!p.placeShip(i,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!p.placeShip(s,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!p.placeShip(r,Math.floor(10*Math.random()),Math.floor(10*Math.random())););}(),function(){const e=window.document.querySelectorAll(".player-grid-item");let t=h.getCells();e.forEach(((e,l)=>{t.some((t=>t.toString()===e.id))&&e.classList.add("player-has-ship")}));const l=window.document.querySelectorAll(".AI-grid-item");let i=p.getCells();i.forEach((e=>{})),l.forEach(((e,t)=>{i.some((t=>t.toString()===e.id))&&e.classList.add("ai-has-ship")}))}())})),T.addEventListener("click",(function(){A.forEach((e=>{e.classList.remove("place-ship-hover","placed-ship")})),M(),E(),m(),a=0,k()}))})();
