(()=>{"use strict";function e(e,t,l){let r=0;return{length:e,hits:r,direction:t,name:l,getHits:()=>r,increaseHit:()=>{r++},isSunk:()=>r>=e}}function t(){let e=[],t=[],l=[],r=[];const i=()=>e,o=()=>l;return{placeShip:(l,r,i)=>!!((e,l,r)=>{let i=[],o=!1;for(let t=0;t<e.length;t++)"horizontal"===e.direction?i.push([l+t,r]):i.push([l,r+t]);return i.forEach((e=>{t.some(((t,l)=>t[0]===e[0]&&t[1]===e[1]))&&(o=!0)})),!1===o&&("horizontal"===e.direction?l+e.length-1<10:r+e.length-1<10)})(l,r,i)&&(((l,r,i)=>{if("horizontal"===l.direction)for(let o=0;o<l.length;o++)e.push([l,r+o,i]),t.push([r+o,i]);else for(let o=0;o<l.length;o++)e.push([l,r,i+o]),t.push([r,i+o])})(l,r,i),!0),receiveAttack:(e,n)=>{let[...a]=i(),s=a.find(((t,l)=>t[1]===e&&t[2]===n));return null!=s?(void 0===r.find(((t,l)=>t[0]===e&&t[1]===n))&&(r.push([e,n]),s[0].increaseHit()),!0):o().find(((t,l)=>t[0]===e&&t[1]===n))?void 0:(l.push([e,n]),t.push([e,n]),!1)},areAllSunk:()=>e.length===r.length,getCells:()=>t,getOccupiedCells:i,getHit:()=>r,getMissed:o}}document.querySelector(".grids");const l=document.querySelector(".player-grid"),r=document.querySelector(".AI-grid");let i,o,n;function a(e){if(!u()){let t;if("player"===i.getTurn()){let l=e.id.split(",");if(t=i.playerTurn(n,Number(l[0]),Number(l[1])),"hit"===t){let[...t]=n.getHit();[...t].forEach((t=>{t[0]===Number(l[0])&&t[1]===Number(l[1])&&(e.classList.add("hitted-cell"),e.classList.add("disabled-cell"))})),c("ai")}else e.classList.add("missed-cell"),e.classList.add("disabled-cell"),s()}}}function s(e){if(!u()){let t;if("AI"===i.getTurn())if(t=void 0===e?i.AITurn(o):i.AITurn(o,e[0],e[1]),"AlreadyPlayed"===t[1])s();else if("missed"===t[1])[...l.childNodes].forEach((e=>{let l=e.id.split(",");t[0][0]===Number(l[0])&&t[0][1]===Number(l[1])&&setTimeout((()=>{e.classList.add("missed-cell")}),1e3)}));else if("hit"===t[1]){let[e]=i.getRandomAdjacent(t[0][0],t[0][1],o);[...l.childNodes].forEach((e=>{let l=e.id.split(",");Number(l[0])===t[0][0]&&Number(l[1])===t[0][1]&&setTimeout((()=>{e.classList.add("hitted-cell")}),0)})),c("player"),s(e)}}}function c(e){"ai"===e?n.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(d(t,e),h(t,e))})):o.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(d(t,e),h(t,e))}))}!function(){for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let r=document.createElement("div");l.appendChild(r).className="player-grid-item",r.innerText=`${t},${e}`,r.id=`${t},${e}`}}for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let l=document.createElement("div");r.appendChild(l).className="AI-grid-item",l.innerText=`${t},${e}`,l.id=`${t},${e}`}}}(),f();const d=(e,t)=>{const l=window.document.querySelectorAll(".player-grid-item"),r=window.document.querySelectorAll(".AI-grid-item");"ai"===t?r.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("has-ship")){let l=t.id.split(",");Number(l[0])===e[1]&&Number(l[1])===e[2]&&t.classList.add("sunk")}})):l.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("has-ship")){let l=t.id.split(",");Number(l[0])===e[1]&&Number(l[1])===e[2]&&t.classList.add("sunk")}}))},h=(e,t)=>{const l=document.querySelectorAll(".ai-ships"),r=document.querySelectorAll(".player-ships");"ai"===t?l.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")})):r.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")}))},u=()=>{if(n.areAllSunk()||o.areAllSunk())return m(),document.querySelector(".restart").classList.add("visible"),!0};function m(){const e=document.querySelector(".winner");o.areAllSunk()?e.innerText="AI Won":e.innerText="You Won"}function f(){i=function(){let e="player";return{getTurn:()=>e,changeTurn:t=>{console.log(`from player ${e}`),e=t},playerTurn:(t,l,r)=>{let i=t.receiveAttack(l,r);return void 0===i?"AlreadyMissed":i?i?"hit":void 0:(e="AI","missed")},AITurn:(t,l,r)=>{let i,o;return void 0===l&&void 0===r?(o=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],i=t.receiveAttack(o[0],o[1])):(o=[l,r],i=t.receiveAttack(l,r)),void 0===i?[o,"AlreadyPlayed"]:void 0!==i&&!0!==i?(e="player",[o,"missed"]):[o,"hit"]},getRandomAdjacent:(e,t,l)=>{let r=[[e+1,t],[e-1,t],[e,t+1],[e,t-1]].filter((e=>e[0]>=0&&e[0]<=9&&e[1]>=0&&e[1]<=9)),i=l.getMissed(),o=l.getHit(),n=i.concat(o);var a;return[((a=r.filter((e=>function(e){let t=!0;for(let l=0;l<n.length;l++)n[l][0]===e[0]&&n[l][1]===e[1]&&(t=!1);return t}(e))))[Math.floor(Math.random()*a.length)],a[Math.floor(Math.random()*a.length)])]}}}(),o=t(),n=t(),function(){let t=e(4,"horizontal","battleship"),l=e(3,"vertical","cruiser"),r=e(3,"horizontal","submarine"),i=e(2,"vertical","patrol");o.placeShip(t,1,0),o.placeShip(l,3,5),o.placeShip(r,4,8),o.placeShip(i,7,6)}(),function(){let t=["horizontal","vertical"],l=e(4,t[Math.floor(Math.random()*t.length)],"battleship"),r=e(3,t[Math.floor(Math.random()*t.length)],"cruiser"),i=e(3,t[Math.floor(Math.random()*t.length)],"submarine"),o=e(2,t[Math.floor(Math.random()*t.length)],"patrol");for(console.log(l),console.log(r),console.log(i),console.log(o);!n.placeShip(l,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(r,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(i,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!n.placeShip(o,Math.floor(10*Math.random()),Math.floor(10*Math.random())););}(),function(){const e=window.document.querySelectorAll(".player-grid-item");let t=o.getCells();e.forEach(((e,l)=>{t.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}));const l=window.document.querySelectorAll(".AI-grid-item");let r=n.getCells();r.forEach((e=>{})),l.forEach(((e,t)=>{r.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}))}()}[...r.childNodes].forEach(((e,t)=>{e.addEventListener("click",(function(){a(e),u()&&m()}))})),document.querySelector(".restart").addEventListener("click",(function(){(()=>{const e=window.document.querySelectorAll(".player-grid-item"),t=window.document.querySelectorAll(".AI-grid-item");e.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell")})),t.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell")}))})(),(()=>{const e=document.querySelector(".winner");document.querySelector(".restart").classList.remove("visible"),e.innerText=""})(),f()}))})();