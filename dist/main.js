(()=>{"use strict";function e(e,t,l){let i=0;return{length:e,hits:i,direction:t,name:l,getHits:()=>i,increaseHit:()=>{i++},isSunk:()=>i>=e}}function t(){let e=[],t=[],l=[],i=[];const r=()=>e,s=()=>l;return{placeShip:(l,i,r)=>(console.log(l,i,r),!!((e,l,i)=>{let r=[],s=!1;for(let t=0;t<e.length;t++)"horizontal"===e.direction?r.push([l+t,i]):r.push([l,i+t]);return r.forEach((e=>{t.some(((t,l)=>t[0]===e[0]&&t[1]===e[1]))&&(s=!0)})),!1===s&&("horizontal"===e.direction?l+e.length-1<10:i+e.length-1<10)})(l,i,r)&&(((l,i,r)=>{if("horizontal"===l.direction)for(let s=0;s<l.length;s++)e.push([l,i+s,r]),t.push([i+s,r]);else for(let s=0;s<l.length;s++)e.push([l,i,r+s]),t.push([i,r+s])})(l,i,r),console.log("valid"),!0)),receiveAttack:(e,n)=>{let[...o]=r(),c=o.find(((t,l)=>t[1]===e&&t[2]===n));return null!=c?(void 0===i.find(((t,l)=>t[0]===e&&t[1]===n))&&(i.push([e,n]),c[0].increaseHit()),!0):s().find(((t,l)=>t[0]===e&&t[1]===n))?void 0:(l.push([e,n]),t.push([e,n]),!1)},areAllSunk:()=>e.length===i.length,getCells:()=>t,getOccupiedCells:r,getHit:()=>i,getMissed:s}}let l="x",i=0;const r=()=>0===i?4:1===i||2===i?3:2,s=(document.querySelector(".grids"),document.querySelector(".player-grid")),n=document.querySelector(".AI-grid");let o,c,a;function d(){o=function(){let e="player";return{getTurn:()=>e,changeTurn:t=>{console.log(`from player ${e}`),e=t},playerTurn:(t,l,i)=>{let r=t.receiveAttack(l,i);return void 0===r?"AlreadyMissed":r?r?"hit":void 0:(e="AI","missed")},AITurn:(t,l,i)=>{let r,s;return void 0===l&&void 0===i?(s=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],r=t.receiveAttack(s[0],s[1])):(s=[l,i],r=t.receiveAttack(l,i)),void 0===r?[s,"AlreadyPlayed"]:void 0!==r&&!0!==r?(e="player",[s,"missed"]):[s,"hit"]},getRandomAdjacent:(e,t,l)=>{let i=[[e+1,t],[e-1,t],[e,t+1],[e,t-1]].filter((e=>e[0]>=0&&e[0]<=9&&e[1]>=0&&e[1]<=9)),r=l.getMissed(),s=l.getHit(),n=r.concat(s);var o;return[((o=i.filter((e=>function(e){let t=!0;for(let l=0;l<n.length;l++)n[l][0]===e[0]&&n[l][1]===e[1]&&(t=!1);return t}(e))))[Math.floor(Math.random()*o.length)],o[Math.floor(Math.random()*o.length)])]}}}(),c=t(),a=t()}function u(e){if(!g()){let t;if("player"===o.getTurn()){let l=e.id.split(",");if(t=o.playerTurn(a,Number(l[0]),Number(l[1])),"hit"===t){let[...t]=a.getHit();[...t].forEach((t=>{t[0]===Number(l[0])&&t[1]===Number(l[1])&&(e.classList.add("hitted-cell"),e.classList.add("disabled-cell"))})),m("ai")}else e.classList.add("missed-cell"),e.classList.add("disabled-cell"),h()}}}function h(e){if(!g()){let t;if("AI"===o.getTurn())if(t=void 0===e?o.AITurn(c):o.AITurn(c,e[0],e[1]),"AlreadyPlayed"===t[1])h();else if("missed"===t[1])[...s.childNodes].forEach((e=>{let l=e.id.split(",");t[0][0]===Number(l[0])&&t[0][1]===Number(l[1])&&setTimeout((()=>{e.classList.add("missed-cell")}),1e3)}));else if("hit"===t[1]){let[e]=o.getRandomAdjacent(t[0][0],t[0][1],c);[...s.childNodes].forEach((e=>{let l=e.id.split(",");Number(l[0])===t[0][0]&&Number(l[1])===t[0][1]&&setTimeout((()=>{e.classList.add("hitted-cell")}),0)})),m("player"),h(e)}}}function m(e){"ai"===e?a.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(f(t,e),p(t,e))})):c.getOccupiedCells().forEach((t=>{t[0].isSunk()&&(f(t,e),p(t,e))}))}!function(){document.querySelector(".placing-grid-container");const e=document.querySelector(".start-grid");for(let t=9;t>=0;t--){document.createElement("div");for(let l=0;l<10;l++){let i=document.createElement("div");e.appendChild(i).className="placing-cells-item",i.innerText=`${l},${t}`,i.id=`${l},${t}`}}}(),d(),function(){for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let l=document.createElement("div");s.appendChild(l).className="player-grid-item",l.innerText=`${t},${e}`,l.id=`${t},${e}`}}for(let e=9;e>=0;e--){document.createElement("div");for(let t=0;t<10;t++){let l=document.createElement("div");n.appendChild(l).className="AI-grid-item",l.innerText=`${t},${e}`,l.id=`${t},${e}`}}}();const f=(e,t)=>{const l=window.document.querySelectorAll(".player-grid-item"),i=window.document.querySelectorAll(".AI-grid-item");"ai"===t?i.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("has-ship")){let l=t.id.split(",");Number(l[0])===e[1]&&Number(l[1])===e[2]&&t.classList.add("sunk")}})):l.forEach((t=>{if(!t.classList.contains("sunk")&&t.classList.contains("has-ship")){let l=t.id.split(",");Number(l[0])===e[1]&&Number(l[1])===e[2]&&t.classList.add("sunk")}}))},p=(e,t)=>{const l=document.querySelectorAll(".ai-ships"),i=document.querySelectorAll(".player-ships");"ai"===t?l.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")})):i.forEach((t=>{t.innerText===e[0].name&&t.classList.add("lineOver")}))},g=()=>{if(a.areAllSunk()||c.areAllSunk())return v(),document.querySelector(".restart").classList.add("visible"),!0};function v(){const e=document.querySelector(".winner");c.areAllSunk()?e.innerText="AI Won":e.innerText="You Won"}[...n.childNodes].forEach(((e,t)=>{e.addEventListener("click",(function(){u(e),g()&&v()}))}));const y=window.document.querySelector(".start-grid").childNodes;[...y].forEach(((t,s)=>{t.addEventListener("mouseenter",(function(){i<4&&function(e,t){let i=e.id.split(","),s=r(),n=!0;if("x"===l){for(let e=0;e<s;e++)if(y[t+e]&&y[t+e].classList.contains("placed-ship")){n=!1;break}if(n&&Number(i[0])+s-1<=9)for(let e=0;e<s;e++)y[t+e].classList.add("place-ship-hover")}else{for(let e=0;e<s;e++)if(y[t-10*e]&&y[t-10*e].classList.contains("placed-ship")){n=!1;break}if(n&&Number(i[1])+s-1<=9)for(let e=0;e<s;e++)y[t-10*e].classList.add("place-ship-hover")}}(t,s)})),t.addEventListener("mouseleave",(function(){i<4&&function(e,t){let i=e.id.split(","),s=r();if("x"===l){if(Number(i[0])+s-1<=9)for(let e=0;e<s;e++)y[t+e].classList.remove("place-ship-hover")}else if(Number(i[1])+s-1<=9)for(let e=0;e<s;e++)y[t-10*e].classList.remove("place-ship-hover")}(t,s)})),t.addEventListener("click",(function(){t.classList.contains("place-ship-hover")&&i<4&&!t.classList.contains("placed-ship")&&(i++,function(t){let r=t.id.split(","),s="x"===l?"horizontal":"vertical";switch(i){case 1:let t=e(4,s,"battleship");c.placeShip(t,Number(r[0]),Number(r[1]));break;case 2:let l=e(3,s,"cruiser");c.placeShip(l,Number(r[0]),Number(r[1]));break;case 3:let i=e(3,s,"submarine");c.placeShip(i,Number(r[0]),Number(r[1]));break;case 4:let n=e(2,s,"patrol");c.placeShip(n,Number(r[0]),Number(r[1]))}}(t),console.log(l),y.forEach((e=>{e.classList.contains("place-ship-hover")&&e.classList.add("placed-ship")})))}))})),document.querySelector(".restart").addEventListener("click",(function(){(()=>{const e=window.document.querySelectorAll(".player-grid-item"),t=window.document.querySelectorAll(".AI-grid-item");e.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell","sunk")})),t.forEach((e=>{e.classList.remove("has-ship","hitted-cell","missed-cell","disabled-cell","sunk")}));const l=document.querySelector(".ships").children;let i=l[0].children,r=l[1].children;[...i].forEach((e=>{e.classList.remove("lineOver")})),[...r].forEach((e=>{e.classList.remove("lineOver")}))})(),(()=>{const e=document.querySelector(".winner");document.querySelector(".restart").classList.remove("visible"),e.innerText=""})(),d(),i=0,y.forEach((e=>{e.classList.contains("placed-ship")&&e.classList.remove("placed-ship"),e.classList.contains("place-ship-hover")&&e.classList.remove("place-ship-hover")})),document.querySelector(".placing-grid-container").style.display="flex"}));const L=document.querySelector(".x"),S=document.querySelector(".y");L.addEventListener("click",(function(){l="x"})),S.addEventListener("click",(function(){l="y"})),document.querySelector(".reset"),document.querySelector(".place").addEventListener("click",(function(){console.log(i),i>=4&&(document.querySelector(".placing-grid-container").style.display="none",function(){let t=["horizontal","vertical"],l=e(4,t[Math.floor(Math.random()*t.length)],"battleship"),i=e(3,t[Math.floor(Math.random()*t.length)],"cruiser"),r=e(3,t[Math.floor(Math.random()*t.length)],"submarine"),s=e(2,t[Math.floor(Math.random()*t.length)],"patrol");for(;!a.placeShip(l,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!a.placeShip(i,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!a.placeShip(r,Math.floor(10*Math.random()),Math.floor(10*Math.random())););for(;!a.placeShip(s,Math.floor(10*Math.random()),Math.floor(10*Math.random())););}(),function(){const e=window.document.querySelectorAll(".player-grid-item");let t=c.getCells();e.forEach(((e,l)=>{t.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}));const l=window.document.querySelectorAll(".AI-grid-item");let i=a.getCells();i.forEach((e=>{})),l.forEach(((e,t)=>{i.some((t=>t.toString()===e.id))&&e.classList.add("has-ship")}))}())}))})();